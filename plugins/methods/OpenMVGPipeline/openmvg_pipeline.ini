[openmvg_pipeline]

# Performance analysis description
ProfileCommit=OpenMVG preprocessing plugin configuration

# Performance analysis options
enable_profiling=true    # Whether to enable performance analysis
enable_evaluator=false    # Whether to enable evaluator

# ======================================================
# General Settings
# ======================================================
# Input image folder
; images_folder = {root_dir}/castle-P19/images
images_folder = {root_dir}/castle-P30/images
; images_folder = {root_dir}/entry-P10/images
; images_folder = {root_dir}/fountain-P11/images
; images_folder = {root_dir}/Herz-Jesus-P8/images
; images_folder = {root_dir}/Herz-Jesus-P25/images


# OpenMVG binary files directory - auto detection
# The system will automatically detect the following paths:
# - ../../dependencies/openMVG/build/Darwin-arm64-Release  (macOS Apple Silicon)
# - ../../dependencies/openMVG/build/Darwin-x86_64-Release (macOS Intel)
# - ../../dependencies/openMVG/build/Linux-x86_64-Release  (Linux)
# - Installation location in system PATH


# Working directory (temporary directory created during plugin execution)
work_dir = {exe_dir}/openmvg_strecha_test_work

# Whether to clear the working directory before running
# true: Delete and recreate work_dir directory before each run (ensures clean runtime environment)
# false: Keep existing files in working directory (can be used for incremental processing or debugging)
is_reclear_workdir = true

# Whether to force recompute all steps (do not use existing cache files)
force_compute = false

# Whether to output detailed debug logs (if true, plugin will keep work_dir for inspection)
debug_output = true

# Whether to convert putative matches data instead of geometrically filtered matches data
# If true, use match files directly generated by ComputeMatches (usually matches.putative.bin)
# If false, use match files generated by GeometricFilter (usually matches.f.bin or similar)
convert_putative_data = true

# ======================================================
# Note: Pipeline Steps Description
# ======================================================
# Basic steps (always executed):
# 1. SfMInit_ImageListing - Create SfM data file
# 2. ComputeFeatures - Extract image features
# 3. PairGenerator - Generate image pair list (optional, before ComputeMatches)
# 4. ComputeMatches - Compute feature matches (can use pairs file generated by PairGenerator)
# 5. GeometricFilter - Geometric filtering of matches
#
# Optional steps (controlled by corresponding enable_xxx parameters):
# 6. SfM - 3D reconstruction (supports multiple engines: INCREMENTAL/GLOBAL/STELLAR)
# 7. ComputeSfM_DataColor - Color point cloud reconstruction
# 8. EvalQuality - Quality evaluation and comparison with ground truth (requires gt_dataset_path)
#
# Output data:
# - data_images: Image data and camera parameters
# - data_features: Image feature points and descriptors
# - data_matches: Feature match pairs
# If SfM reconstruction is enabled, reconstruction results will be saved in work_dir/reconstruction_dir

# ======================================================
# Intermediate File Paths (relative to work_dir)
# These options control the names and locations of intermediate files
# generated by the OpenMVG tools within the working directory.
# ======================================================

# SfMInit_ImageListing: Output directory for sfm_data.json and feature/match files, relative to work_dir.
# This directory will store sfm_data.json, .feat files, .desc files (if generated), and match files.
sfm_out_dir = matches

# SfMInit_ImageListing: Filename for the SfM data file, within intermediate_files_dir.
sfm_data_file = sfm_data.json

# ComputeMatches: Output filename for putative matches, relative to intermediate_files_dir.
# OpenMVG will infer format (binary/text) from extension (.bin or .txt).
putative_matches = matches.putative.bin

# GeometricFilter: Input putative matches filename, relative to intermediate_files_dir.
# Should typically match the output of ComputeMatches (i.e., the value of putative_matches_filename).
# If left empty, it will default to the value of 'putative_matches_filename'.
geom_filter_in = 

# GeometricFilter: Output filename template for geometrically filtered matches, relative to intermediate_files_dir.
# Use {GEOM_MODEL} as a placeholder for the geometric model (f, e, or h).
# Example: matches.{GEOM_MODEL}.bin or filtered_matches_{GEOM_MODEL}.txt
# OpenMVG will infer format (binary/text) from extension (.bin or .txt).
geom_filter_out_tpl = matches.{GEOM_MODEL}.bin

# ======================================================
# Original OpenMVG settings below
# ======================================================

# Number of threads used for some parallel steps in OpenMVG (0 means auto-select, usually max available threads)
num_threads = 0

# Maximum memory for feature descriptor cache (MB), 0 means unlimited (OpenMVG ComputeFeatures/ComputeMatches/GeometricFilter)
cache_size = 0

# Whether to save features and matches to files
save_features = true
save_matches = true

# Paths for saving features and matches
features_save_path = storage/features/features_all
matches_save_path = storage/matches/matches_all

# ======================================================
# SfMInit_ImageListing Settings (openMVG_main_SfMInit_ImageListing)
# ======================================================
# Camera sensor width database file path. If left empty, OpenMVG will not use database.
# OpenMVG default installation path is usually /usr/local/share/openMVG/sensor_width_camera_database.txt
camera_sensor_db = 

# Camera model type
# 1: Pinhole camera
# 2: Pinhole with 1 radial distortion parameter
# 3: Pinhole with 3 radial distortion parameters
# 4: Brown model with tangential distortion
camera_model = 1

# Camera intrinsic matrix, format: "fx;0;cx;0;fy;cy;0;0;1"
# If not specified, will try to get from EXIF or camera_sensor_db
intrinsics = 

# Pixel focal length, used only when cannot be obtained from EXIF or intrinsics
# Default is -1, which means OpenMVG will try to estimate from EXIF information
focal_pixels = -1.0

# Whether to treat all images as sharing the same intrinsics
# 0: Use separate intrinsics for each image
# 1: All images share intrinsics
group_camera_model = 1

# Whether to use prior poses (such as using EXIF information)
use_pose_prior = false

# Prior pose weights, format: "rotation_weight;GPS_position_weight;GPS_altitude_weight"
prior_weights = 1.0;1.0;1.0

# GPS to XYZ conversion method
# 0: Conversion from ECEF (WGS84) to XYZ
# 1: Conversion from UTM (WGS84) to XYZ
gps_to_xyz_method = 0

# ======================================================
# ComputeFeatures Settings (openMVG_main_ComputeFeatures)
# ======================================================
# Feature descriptor method
# SIFT, AKAZE, AKAZE_FLOAT, AKAZE_MLDB
describer_method = SIFT

# Preset quality level for feature descriptors
# LOW, MEDIUM, NORMAL, HIGH, ULTRA
describer_preset = NORMAL

# Whether to use upright descriptors (ignore orientation information)
upright = false

# ======================================================
# ComputeMatches Settings (openMVG_main_ComputeMatches)
# ======================================================
# Feature matching method
# BRUTEFORCEL2: Brute force matching with L2 distance
# ANNL2: Approximate nearest neighbor L2 distance
# CASCADEHASHINGL2: Cascade hashing L2 distance
# FASTCASCADEHASHINGL2: Fast cascade hashing L2 distance
# BRUTEFORCEHAMMING: Brute force matching with Hamming distance
nearest_matching_method = FASTCASCADEHASHINGL2

# Lowe ratio test threshold (0.8 is commonly used)
ratio = 0.8

# Specified image pair list file path (if empty, match all image pairs)
pair_list = 

# Whether to use preemptive filtering method (quickly filter image pairs using a small number of features)
use_preemptive = false

# Number of features used for preemptive filtering
preemptive_feature_count = 200

# ======================================================
# GeometricFilter Settings (openMVG_main_GeometricFilter)
# ======================================================
# Geometric model filter type
# f: Fundamental Matrix
# e: Essential Matrix
# h: Homography Matrix
geometric_model = f

# Input image pair list file path (if empty, process all matched image pairs)
input_pairs = 

# Output image pair list file path (if empty, do not save)
output_pairs = 

# Whether to use guided matching for refinement
guided_matching = false

# RANSAC maximum iteration count
max_iteration = 2048 

# ======================================================
# PairGenerator Settings (openMVG_main_PairGenerator) - Optional step
# ======================================================
# Whether to enable PairGenerator step (used to generate image pair list)
enable_pair_generator = true

# Output pairs filename, relative to intermediate_files_dir
pairs_file = pairs.bin

# Image pair generation mode
# EXHAUSTIVE: Exhaustive all image pairs
# CONTIGUOUS: Contiguous image pairs
# VOCABULARY_TREE: Image pair selection based on vocabulary tree
pair_mode = 

# Number of contiguous image pairs (used when pair_mode is CONTIGUOUS)
contiguous_count = 

# ======================================================
# SfM Reconstruction Settings (openMVG_main_SfM) - Optional step
# ======================================================
# Whether to enable SfM reconstruction step
enable_sfm_reconstruction = true

# SfM reconstruction output directory name (relative to work_dir)
reconstruction_dir = reconstruction_global

# SfM engine type
# INCREMENTAL: Incremental reconstruction
# INCREMENTALV2: Incremental reconstruction V2 (experimental)
# GLOBAL: Global reconstruction
# STELLAR: Stellar reconstruction
sfm_engine = GLOBAL

# PoSDK tracks file export path
# If a path is specified, OpenMVG SfM will export tracks file to the specified location
# If empty string, tracks file will not be exported
# Example: export_tracks_file = storage/tracks/tracks_all.tracks
# /Users/caiqi/Documents/PoMVG/src/build/Desktop_arm_darwin_generic_mach_o_64bit-Debug/output/bin/tracks.track
export_tracks_file = 

# PoSDK relative poses file export path
# If a path is specified, OpenMVG SfM will export relative poses file to the specified location
# If empty string, relative poses file will not be exported
# Example: export_relative_poses_file = storage/poses/relative_poses.g2o
# export_relative_poses_file = /Users/caiqi/Documents/PoMVG/src/build/Desktop_arm_darwin_generic_mach_o_64bit-Debug/output/bin/relative_poses.g2o
export_relative_poses_file = 
# ======================================================
# Bundle Adjustment Settings
# ======================================================
# Intrinsic refinement configuration
# ADJUST_ALL: Refine all existing parameters (default)
# NONE: Keep intrinsics unchanged
# ADJUST_FOCAL_LENGTH: Refine only focal length
# ADJUST_PRINCIPAL_POINT: Refine only principal point position
# ADJUST_DISTORTION: Refine only distortion coefficients
# Can be combined with '|', e.g.: ADJUST_FOCAL_LENGTH|ADJUST_PRINCIPAL_POINT
refine_intrinsic_config = NONE

# Extrinsic refinement configuration
# ADJUST_ALL: Refine all existing parameters (default)
# NONE: Keep extrinsics unchanged
refine_extrinsic_config = ADJUST_ALL

# Whether to use motion priors (such as GPS positions)
use_motion_priors = false

# ======================================================
# Incremental SfM Settings (when sfm_engine is INCREMENTAL)
# ======================================================
# Triangulation method
# 0: DIRECT_LINEAR_TRANSFORM
# 1: L1_ANGULAR
# 2: LINFINITY_ANGULAR
# 3: INVERSE_DEPTH_WEIGHTED_MIDPOINT
triangulation_method = 

# Camera pose estimation method
# 0: DLT_6POINTS
# 1: P3P_KE_CVPR17
# 2: P3P_KNEIP_CVPR11
# 3: P3P_NORDBERG_ECCV18
# 4: P3P_DING_CVPR23
# 5: UP2P_KUKELOVA_ACCV10
resection_method = 

# SfM camera model type (for views with unknown intrinsics)
# 1: Pinhole
# 2: Pinhole radial 1
# 3: Pinhole radial 3 (default)
# 4: Pinhole radial 3 + tangential 2
# 5: Pinhole fisheye
sfm_camera_model = 3

# Initial image pair (for INCREMENTAL only)
# First image filename (without path)
initial_pair_a = 

# Second image filename (without path)
initial_pair_b = 

# ======================================================
# Incremental SfM V2 Settings (when sfm_engine is INCREMENTALV2)
# ======================================================
# SfM initialization method
# EXISTING_POSE: Initialize reconstruction from existing sfm_data camera poses
# MAX_PAIR: Initialize reconstruction from image pair with most matches
# AUTO_PAIR: Automatically select image pair to initialize reconstruction
# STELLAR: Initialize using stellar reconstruction
sfm_initializer = STELLAR

# ======================================================
# Global SfM Settings (when sfm_engine is GLOBAL)
# ======================================================
# Rotation averaging method
# 1: L1 minimization
# 2: L2 minimization (default)
rotation_averaging = 2

# Translation averaging method
# 1: L1 minimization
# 2: L2 minimization of chordal distance squared
# 3: SoftL1 minimization (default)
# 4: LiGT: Linear global translation constraints from rotations and matches
translation_averaging = 3

# ======================================================
# Stellar SfM Settings (when sfm_engine is STELLAR)
# ======================================================
# Graph simplification method
# NONE: No simplification
# MST_X: Minimum spanning tree simplification
# STAR_X: Star simplification
graph_simplification = MST_X

# Graph simplification value (must be > 1)
graph_simplification_value = 5

# ======================================================
# ComputeSfM_DataColor Settings (openMVG_main_ComputeSfM_DataColor) - Optional step
# ======================================================
# Whether to enable point cloud coloring step
enable_point_cloud_coloring = true

# Colored point cloud filename
colored_ply_file = colorized.ply

# ======================================================
# EvalQuality Settings (openMVG_main_evalQuality) - Optional step
# ======================================================
# Whether to enable quality evaluation step (comparison with ground truth dataset)
enable_quality_evaluation = true

# Ground truth dataset path
# For Strecha dataset, can be:
# 1. Directory path containing gt_dense_cameras folder (e.g.: /path/to/castle-P19)
# 2. Direct path to ground truth sfm_data file (e.g.: /path/to/gt_sfm_data.bin)
gt_dataset_path = {images_folder}/..

# Quality evaluation result output directory name (relative to work_dir)
eval_output_dir = quality_evaluation
