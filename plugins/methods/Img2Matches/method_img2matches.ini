[method_img2matches]
# Performance analysis description | 性能分析描述
ProfileCommit=Fix ORB descriptor type compatibility + optimize feature matching performance       # Configuration change description, similar to git commit message | 配置变更描述，类似git提交信息

# Performance analysis options | 性能分析选项
enable_profiling=true    # Whether to enable performance analysis | 是否启用性能分析

# Metrics configuration for profiling | 性能分析的指标配置
# Available metrics: time, memory, cpu | 可用指标：time（时间）, memory（内存）, cpu（CPU）
# Format: "time" or "time|memory" or "time|memory|cpu" | 格式："time" 或 "time|memory" 或 "time|memory|cpu"
# Note: memory tracking adds ~5-10ms overhead per checkpoint | 注意：内存跟踪会在每个检查点增加约5-10ms开销
# Recommended: "time" for production, "time|memory" for profiling | 推荐：生产环境用"time"，性能分析时用"time|memory"
metrics_config=time

enable_evaluator=false    # Whether to enable evaluation | 是否启用评估

# Log level: 2=verbose, 1=normal, 0=none | 日志级别：2=详细，1=正常，0=无
log_level=0 

# Run mode: fast=fast mode, viewer=visualization mode    
run_mode=fast

# Multi-threading configuration
num_threads=4                   # Number of threads for feature extraction parallelization (supports win/mac/ubuntu)

# ==================================================
# Feature extraction configuration (inherited from MethodImg2FeaturesPlugin)
# ==================================================
detector_type=SIFT       # Feature detector type: SIFT, ORB, AKAZE, BRISK, KAZE, FAST, AGAST, SUPERPOINT

# Feature output control
export_features=false    # Whether to export feature files
export_fea_path=storage/features      # Feature output path (leave empty to use default path)

# ==================================================
# Matching configuration  
# ==================================================
# Match result export configuration
export_matches=false
export_match_path=storage/matches

# ================================================  
# Add matching related configuration
# Note: Matcher type will be automatically adjusted based on descriptor type to ensure compatibility
# - Binary descriptors (ORB/BRIEF/BRISK) will automatically use BRUTEFORCE_HAMMING
# - Float descriptors (SIFT) will automatically use BRUTEFORCE or FLANN
# ================================================    

# Matcher type selection
matcher_type=FLANN  # Options: FASTCASCADEHASHINGL2, FLANN, BF, BF_NORM_L1, BF_HAMMING, LIGHTGLUE
# FASTCASCADEHASHINGL2 - Fast cascade hashing L2 matching (OpenMVG style, suitable for float descriptors like SIFT, recommended)
# FLANN      - FLANN-based fast matching (only for float descriptors like SIFT)
# BF         - Standard brute force matching (L2 distance, suitable for float descriptors like SIFT)
# BF_NORM_L1 - L1 norm brute force matching (suitable for float descriptors)
# BF_HAMMING - Hamming distance brute force matching (suitable for binary descriptors)
# LIGHTGLUE  - LightGlue deep learning matcher (supports SuperPoint/DISK/SIFT/ALIKED features, high quality)
#   - ORB: binary descriptor, suitable for BF_HAMMING
#   - BRISK: binary descriptor, suitable for BF_HAMMING
#   - AKAZE: binary descriptor, suitable for BF_HAMMING
#   - SIFT: float descriptor, suitable for FLANN/BF/BF_NORM_L1
#   - KAZE: float descriptor, suitable for FLANN/BF/BF_NORM_L1
#   - FAST: needs to be used with descriptor, if ORB descriptor then use BF_HAMMING
#   - AGAST: needs to be used with descriptor, if ORB descriptor then use BF_HAMMING



cross_check=false    # Disable cross check to simulate OpenMVG FASTCASCADEHASHINGL2 behavior
ratio_thresh=0.8     # Lowe's ratio test threshold (consistent with OpenMVG, 0.6-0.9 range, 0.8 for balance)
max_matches=0        # Maximum number of matches, 0 means no limit (consistent with OpenMVG)

# View pair selection
show_view_pair_i=0    # First image index
show_view_pair_j=1    # Second image index

# ==================================================
# Feature detector detailed parameter configuration
# ==================================================

[SIFT]
# ===== OpenCV style parameters =====
nfeatures=0            # Number of detected features, 0 means no limit. Higher values detect more features but increase computation.
nOctaveLayers=3        # Number of octave layers (corresponds to OpenMVG's num_scales). More layers provide finer detection but slower speed.
contrastThreshold=0.015 # Contrast threshold. Adjusted through actual comparison to align feature count with OpenMVG (~20k features)
edgeThreshold=10       # Edge threshold to prevent extracting edge features. Higher values reduce edge features and improve stability.
sigma=3              # Gaussian blur coefficient, assumed blur level of input image. Higher values provide smoother features with better noise resistance but may lose details.
enable_precise_upscale=false # Whether to enable precise upscaling (OpenCV specific). Improves high-resolution feature detection accuracy but slower.

# ===== OpenMVG style extended parameters =====
first_octave=0         # Starting octave level: -1=upsampling, 0=original image, 1=downsampling. -1 improves precision but slower, 1 for fast rough detection.
num_octaves=6          # Maximum number of octaves, automatically limited by image size. More octaves provide better scale adaptability but increase computation.
root_sift=true         # Whether to use RootSIFT normalization (improves matching performance). Better matching robustness when enabled, recommended.

# ===== Preset configuration support =====
preset=HIGH          # SIFT preset: NORMAL, HIGH, ULTRA, CUSTOM
# NORMAL: contrastThreshold=0.04,  first_octave=0      - Standard quality, fastest speed
# HIGH:   contrastThreshold=0.015, first_octave=0      - High quality, feature count aligned with OpenMVG (~20k features) ← Currently used
# ULTRA:  contrastThreshold=0.015, first_octave=-1     - Ultra high quality + upsampling, aligned with OpenMVG but slower
# CUSTOM: Use detailed parameters above                 - Fully customized configuration

[SURF]
# ===== OpenCV SURF parameters =====
hessianThreshold=200    # Hessian keypoint detector threshold (higher values = fewer features, recommended 100-400)
nOctaves=3               # Number of pyramid octaves (suggested 3-6)
nOctaveLayers=6          # Number of layers within each octave (usually 3)
extended=false           # Extended descriptor: false=64D (faster), true=128D (more accurate)
upright=false           # Upright features: false=rotation invariant, true=faster but no rotation invariance

# ===== Usage recommendations =====
# Real-time applications: hessianThreshold=400-1000, upright=true, extended=false
# High-precision matching: hessianThreshold=100-300, upright=false, extended=true
# Balanced configuration: hessianThreshold=200, upright=false, extended=false

[ORB]
# ===== ORB optimized configuration - Increase feature count and quality =====
nfeatures=20000        # Feature count: increased from 10000 to 20000, improving feature density
scaleFactor=1.15       # Pyramid scale factor: reduced from 1.2 to 1.15, increases scale level overlap, improves scale invariance
nlevels=12            # Pyramid levels: increased from 8 to 12, provides better scale coverage
edgeThreshold=40      # Edge threshold: increased from 31 to 40, allows more valid features near edges
firstLevel=0          # First level: keep 0, start detection from original image
WTA_K=2              # Number of point pairs for BRIEF descriptor computation: keep 2, standard configuration
scoreType=HARRIS_SCORE # Score type: keep HARRIS_SCORE, provides best feature point quality scoring
patchSize=31         # Feature point surrounding area size: keep 31, balances accuracy and computational efficiency
fastThreshold=12     # FAST detector threshold: reduced from 20 to 12, increases detection sensitivity, obtains more features

# ===== ORB optimization expected effects =====
# Quantity improvement: Feature count expected to increase 80-100% (from ~10k to 18-20k features)
# Quality improvement: Better scale invariance, more uniform feature distribution, more stable matching performance
# Performance impact: Computation time expected to increase 50-70%, but matching success rate and accuracy significantly improved
# Use cases: High-resolution images, complex scenes, high-precision 3D reconstruction tasks

[AKAZE]
descriptor_type=DESCRIPTOR_MLDB  # Descriptor type, fixed to use DESCRIPTOR_MLDB
descriptor_size=0    # Descriptor size, fixed to 0
descriptor_channels=3 # Descriptor channels, fixed to 3
threshold=0.001      # Detection threshold
nOctaves=4          # Number of pyramid groups
nOctaveLayers=4     # Number of layers per group
diffusivity=DIFF_PM_G2 # Diffusion type, fixed to use DIFF_PM_G2

[BRISK]
thresh=30           # Detection threshold
octaves=3          # Number of pyramid groups
patternScale=1.0   # Sampling pattern scale factor

[KAZE]
extended=false      # Whether to use extended descriptor
upright=false      # Whether to use upright mode
threshold=0.001    # Detection threshold
nOctaves=4         # Number of pyramid groups
nOctaveLayers=4    # Number of layers per group
diffusivity=DIFF_PM_G2 # Diffusion type, fixed to use DIFF_PM_G2

[FAST]
threshold=10        # Detection threshold (recommended range: 10-40)
nonmaxSuppression=true # Whether to use non-maximum suppression

[AGAST]
threshold=10        # Detection threshold (recommended range: 10-40)
nonmaxSuppression=true # Whether to use non-maximum suppression
type=OAST_9_16     # Detector type, options: AGAST_5_8, AGAST_7_12d, AGAST_7_12s, OAST_9_16

[SUPERPOINT]
# SuperPoint deep learning feature extractor configuration
max_keypoints=3072      # Maximum number of keypoints, limits the upper bound of detected features per image, higher values extract more points, suitable for high-resolution or high-precision scenarios
detection_threshold=0.002  # Detection threshold, lower values detect more features but may introduce more noise points, adjust according to actual needs
nms_radius=4           # Non-maximum suppression radius, controls minimum spatial distance between features, ensures uniform distribution
                       # nms_radius impact analysis:
                       # - Smaller values (1-2): Denser features, more quantity, but may cause clustering, reducing matching stability
                       # - Medium values (3-5): Balance feature quantity and uniform distribution, recommended for general scenarios
                       # - Larger values (6-10): More dispersed features, more uniform distribution, but reduced total quantity, may miss important detail areas
                       # - Recommended range: High-density scenes 2-3, standard scenes 3-5, large scenes or low-texture 5-8
remove_borders=4       # Remove pixels from image borders, avoid edge artifacts, improve feature reliability
python_executable=/Users/caiqi/Documents/PoMVG/src/plugins/methods/Img2Features/conda_env/bin/python  # Use dedicated LightGlue environment, ensure compatibility with mac/ubuntu/win path formats
# Note: SuperPoint requires PyTorch environment and LightGlue dependencies, recommend verifying environment availability beforehand

# ==================================================
# Matcher detailed parameter configuration
# ==================================================

[FLANN]
# === FLANN control method selection ===
use_advanced_control=false  # Whether to use advanced FLANN parameter control
                          # true: Use detailed parameters below for fine control (recommended, higher matching quality)
                          # false: Use OpenCV default FLANN parameters (compatibility mode, faster)

# === FLANN algorithm selection ===
# Algorithm type automatically selected based on descriptor type:
# - SIFT/SURF float descriptors → KDTREE algorithm
# - ORB/BRIEF binary descriptors → LSH algorithm
algorithm=AUTO      # Options: AUTO, KDTREE, LSH, KMEANS, COMPOSITE, LINEAR

# === KDTree algorithm parameters (for SIFT/SURF float descriptors) ===
trees=8             # Number of KDTrees, range [1-16], higher values = higher accuracy but slower, recommended 4-8
                    # OpenCV default 5, accurate matching recommended 8-12, fast matching recommended 4-6

# === LSH algorithm parameters (for ORB/BRIEF binary descriptors) ===  
table_number=12     # Number of hash tables, recommended 6-20, higher values = higher accuracy
key_size=20         # Hash key length, recommended 12-32, higher values = higher accuracy  
multi_probe_level=2 # Multi-probe level, recommended 1-3, higher values = higher accuracy

# === KMeans algorithm parameters (general clustering algorithm) ===
branching=32        # Branching factor, recommended 16-64
iterations=11       # Number of iterations, recommended 5-15
centers_init=CENTERS_RANDOM  # Center initialization: CENTERS_RANDOM, CENTERS_GONZALES, CENTERS_KMEANSPP

# === Search parameters (affect search accuracy and speed) ===
checks=100          # Number of search checks, range [1-∞], higher values = higher accuracy but slower
                    # Fast mode: 32-50, balanced mode: 100-200, accurate mode: 300-500
eps=0.0             # Search accuracy, 0.0 for exact search, higher values = faster but lower accuracy
sorted=true         # Whether to sort results by distance
max_neighbors=-1    # Maximum number of neighbors, -1 means no limit

# === Quality control presets ===
preset=FAST     # FLANN preset: FAST, BALANCED, ACCURATE, CUSTOM
# FAST:     trees=4,  checks=32,  table_number=6,  key_size=12  - Fast matching
# BALANCED: trees=8,  checks=100, table_number=12, key_size=20  - Balance quality and speed  
# ACCURATE: trees=12, checks=300, table_number=20, key_size=32  - High-precision matching
# CUSTOM:   Use detailed parameter configuration above           - Fully customized

# === Usage recommendations ===
# Real-time applications (e.g., video streams): preset=FAST
# General image matching:                       preset=BALANCED  
# High-precision research scenarios:            preset=ACCURATE
# Specific requirement optimization:            preset=CUSTOM

[BF]
# Brute force matcher has no additional parameters

[BF_NORM_L1]
# L1 norm brute force matcher has no additional parameters

[BF_HAMMING]
# Hamming distance brute force matcher has no additional parameters

# ================================================
# LightGlue deep learning matcher configuration
# Uses deep learning technology for feature matching, supports multiple feature types
# ================================================
[LIGHTGLUE]
# === Basic configuration ===
feature_type=SUPERPOINT    # Feature type: SUPERPOINT, DISK, SIFT, ALIKED, DOGHARDNET
max_num_keypoints=2048     # Maximum number of keypoints
depth_confidence=0.95      # Depth confidence (controls early stopping): 0-1, higher = more accurate but slower
width_confidence=0.99      # Width confidence (controls point pruning): 0-1, higher = retain more points
filter_threshold=0.1       # Matching confidence threshold: 0-1, higher = stricter matching

# === Performance optimization ===
flash_attention=true       # Enable FlashAttention optimization (recommended)
mixed_precision=false      # Mixed precision computation (can save memory)
compile_model=false        # Compile model (PyTorch 2.0+, slower first startup but faster afterwards)

# === Environment configuration ===
python_executable=/Users/caiqi/Documents/PoMVG/src/plugins/methods/Img2Features/conda_env/bin/python # Use dedicated LightGlue environment
script_path=               # LightGlue script path (empty value means auto-detection)

# Feature type descriptions:
# SUPERPOINT - 256D features, high accuracy, medium speed
# DISK       - 128D features, fast speed, medium accuracy
# SIFT       - 128D features, classic method, good compatibility
# ALIKED     - 128D features, lightweight, fast speed
# DOGHARDNET - 128D features, high accuracy, high computation
