[barath_two_view_estimator]
# ========================================================================
# Barath Two-View Pose Estimation Parameter Configuration
# Technical Note: This plugin calls Barath's MAGSAC and SupeRANSAC algorithms via Python interface
# - MAGSAC paper: "MAGSAC: marginalizing sample consensus" (CVPR 2019)
# - MAGSAC++ paper: "MAGSAC++, a fast, reliable and accurate robust estimator" (CVPR 2020)  
# - SupeRANSAC paper: "SupeRANSAC: One RANSAC to Rule them All" (arXiv 2024)
# ========================================================================

# ========================================================================
# [REQUIRED PARAMETERS] - These parameters must be configured according to specific scenarios
# ========================================================================

ProfileCommit=Barath Two-View Pose Estimation Parameter Configuration


# ----- View Pair Configuration (Required) -----
view_i=0  # Source view ID - Must be set according to actual view pair
view_j=1  # Target view ID - Must be set according to actual view pair

# ----- Algorithm Selection (Required) -----
# 
# MAGSAC Series Algorithms (Recommended for production):
# - MAGSAC: Original MAGSAC algorithm ⭐ (Recommended, balanced performance and robustness)
# - MAGSAC++: MAGSAC++ improved version ⭐ (Strongest robustness, handles high outlier rates)
#
# SupeRANSAC Series Algorithms (Experimental, excellent performance):
# - SUPERANSAC_DEFAULT: SupeRANSAC default configuration ⭐ (General recommendation)
# - SUPERANSAC_FAST: SupeRANSAC fast configuration (Speed priority)
# - SUPERANSAC_ACCURATE: SupeRANSAC accurate configuration (Accuracy priority)
# - SUPERANSAC_MAGSAC: SupeRANSAC+MAGSAC fusion algorithm ⭐ (Best performance)
# - SUPERANSAC_PARALLEL: SupeRANSAC parallel version (Multi-core recommended)
#
# [Selection Guide]:
# - General scenarios: MAGSAC (Stable and reliable, widely validated)
# - High outlier rates: MAGSAC++ (Latest technology, strongest robustness)
# - Speed required: SUPERANSAC_FAST 
# - Accuracy required: SUPERANSAC_ACCURATE
# - Multi-core environment: SUPERANSAC_PARALLEL
algorithm=MAGSAC++

# ----- Python Environment Configuration (May need to be set) -----
conda_env=                             # Conda environment name (leave empty to use system Python)
                                      # If system Python doesn't have magsac/pysuperansac packages installed, specify environment
                                      # Example: pymagsac_py312, superansac_env etc.

# ========================================================================
# [MAIN PARAMETERS] - Core parameters affecting algorithm performance, recommended to adjust based on data characteristics
# ========================================================================

# ----- Robust Estimation Core Parameters -----
ransac_threshold=0.5                   # RANSAC reprojection error threshold (pixels) ⭐ Important parameter
                                      # Smaller values require higher precision but may be too strict
                                      # Recommended range: 1.0-3.0 pixels, adjust according to image quality
                                      
confidence=0.999                        # RANSAC confidence ⭐ Important parameter
                                      # 0.95: Fast but may not be robust enough
                                      # 0.99: Balanced speed and robustness (recommended)
                                      # 0.999: Maximum robustness but slower

max_iterations=50000                    # Maximum iteration count ⭐ Important parameter
                                      # MAGSAC series: 1000-10000 (adaptive iteration)
                                      # SupeRANSAC series: 500-5000 (usually converges faster)
                                      # Complex scenarios can increase appropriately

min_iterations=50                      # Minimum iteration count
                                      # Ensure algorithm has sufficient sampling opportunities

# ========================================================================
# [BASIC PERFORMANCE PARAMETERS] - Generally use default values, adjust for special requirements
# ========================================================================

log_level=0                          # Log level (0=disable debug, 1=normal, 2=verbose)
enable_profiling=false                # Whether to enable performance profiling
enable_evaluator=false                # Whether to enable evaluator

# ========================================================================
# [ADVANCED PARAMETERS] - Professional users adjust according to specific algorithms and performance requirements
# ========================================================================

# ----- MAGSAC Performance Parameters -----
core_number=4                          # Number of parallel cores
                                      # 1: Single-core processing (Barath default, best stability)
                                      # 2-4: Multi-core parallel (improve sigma-consensus speed)
                                      # Recommended to set according to CPU cores, but don't exceed 4

partition_num=5                        # Number of partitions - affects sigma-consensus speed and accuracy
                                      # Default 5, optional 3-10, higher values mean higher accuracy but slower speed

# ----- MAGSAC Sampler Configuration -----
# [IMPORTANT]: Different samplers have different prerequisites, please choose carefully

sampler_id=4                           # Sampler type ⭐ Affects sampling strategy
# 
# [Sampler Selection Guide]:
# 0 (Uniform): Uniform sampling - Most universal, suitable for most scenarios, minimal computational overhead
#              [Prerequisites]: No special requirements
#              [Use cases]: General scenarios, relatively uniform match point quality
#
# 1 (PROSAC): Quality-based sampling - Requires pre-sorted match points by quality
#             [Prerequisites]: Match points must be sorted by quality score
#             [Use cases]: Feature matching with quality scores
#
# 2 (P-NAPSAC): Spatial neighborhood-aware sampling - Utilizes spatial neighborhood information
#               [Prerequisites]: Must set image_width and image_height
#               [Use cases]: Structured scenes where spatial distribution is meaningful
#               [Related parameters]: pnapsac_layers, pnapsac_blend_ratio
#
# 3 (NG-RANSAC): Deep learning-based sampling - Requires inlier probabilities
#                [Prerequisites]: Requires inlier probabilities from deep learning models
#                [Use cases]: Scenarios with deep learning predictions
#
# 4 (AR-Sampler): Adaptive reordering sampling - Recommended default choice
#                 [Prerequisites]: No special requirements
#                 [Use cases]: Scenarios with complex outlier distributions
#                 [Related parameters]: ar_variance

# ----- Sampler Related Parameters (Only effective for specific samplers) -----

# [Only set when sampler_id=2 (P-NAPSAC)]
image_width=3040                      # Image width - Required for P-NAPSAC sampler
image_height=2014                     # Image height - Required for P-NAPSAC sampler
pnapsac_layers=4                       # P-NAPSAC grid layers - Default 4 layers {16,8,4,2}
pnapsac_blend_ratio=0.5                # Ratio of blending to global sampling - Default 0.5

# [Only adjustable when sampler_id=4 (AR-Sampler)]
ar_variance=0.1                        # AR-Sampler variance parameter - Default 0.1

# ----- Bundle Adjustment Optimization Control -----
# [Purpose]: Bundle Adjustment is a nonlinear optimization technique for refining two-view pose estimation
# [Principle]: Optimizes essential matrix by minimizing reprojection errors to improve estimation accuracy
# [Computational cost]: BA optimization requires additional computation time, especially with many inliers
enable_bundle_adjustment=true          # Whether to enable Bundle Adjustment optimization ⭐ Important parameter
                                      # true: Enable BA optimization, improve accuracy but increase computation time
                                      # false: Skip BA optimization, use only RANSAC/MAGSAC estimation results
                                      # [Recommendation]: Requires MAGSAC library installation, recommended for high-precision applications
                                      # [Note]: If MAGSAC library not installed, BA optimization will be skipped even if set to true

ba_min_inliers=5                       # Minimum inliers required for BA optimization
                                      # [Description]: Skip BA optimization when inliers are fewer than this value
                                      # [Recommendation]: Essential matrix requires at least 5 points, set to 6 for safety margin
                                      # [Range]: 5-20, adjust according to data quality

ba_max_iterations=100                  # Bundle Adjustment maximum iteration count
                                      # [Description]: Controls BA optimization convergence and computation time
                                      # [Recommendation]: 50-200, complex scenarios can increase appropriately
                                      # [Balance]: More iterations mean higher accuracy but longer time

# ----- Adaptive Inlier Selection (Advanced post-processing option) -----
# [Note]: This is an optional post-processing step after MAGSAC, not part of MAGSAC algorithm itself
enable_adaptive_inlier_selection=false # Whether to enable adaptive inlier selection
                                      # [Purpose]: Select an inlier set such that the refitted model is closest to MAGSAC estimated model
                                      # [Recommendation]: Generally keep false unless special requirements in SfM pipeline
                                      # [Warning]: More inliers don't necessarily mean better solution quality
                                      
adaptive_max_threshold=10.0            # Maximum threshold for adaptive selection - Default 10.0 pixels
adaptive_min_inliers=20                # Minimum inliers for adaptive selection - Default 20 

# ========================================================================
# [Parameter Tuning Recommendations]
# ========================================================================
#
# [ransac_threshold Tuning Guide] (Unit: pixels):
# - High-precision cameras (e.g., lab calibrated): 0.5-1.0 pixels
# - General industrial cameras: 1.0-2.0 pixels  
# - Mobile cameras/web images: 1.5-3.0 pixels
# - Low quality/distorted images: 2.0-5.0 pixels
#
# [confidence Tuning Guide]:
# - Quick prototype validation: 0.95 (Speed priority)
# - Production environment: 0.99 (Recommended balance point)
# - Critical missions: 0.999 (Robustness priority)
#
# [max_iterations Tuning Guide]:
# - Quick testing: 500-1000
# - Normal usage: 1000-5000 (Recommended)
# - Complex scenarios: 5000-20000
# - Extreme cases: 20000+ (Use with caution)
#
# [Algorithm Selection Recommendations]:
# - Beginner users: MAGSAC (Stable and reliable)
# - High outlier rates (>70%): MAGSAC++
# - Speed pursuit: SUPERANSAC_FAST
# - Accuracy pursuit: SUPERANSAC_ACCURATE  
# - Multi-core systems: SUPERANSAC_PARALLEL
#
# [Sampler Selection Recommendations]:
# - Uncertain scenarios: sampler_id=4 (AR-Sampler)
# - Images with obvious structure: sampler_id=2 (P-NAPSAC) + set image dimensions
# - With feature quality scores: sampler_id=1 (PROSAC)
# - Fastest speed pursuit: sampler_id=0 (Uniform)
#
# [Bundle Adjustment Recommendations]:
# - High-precision applications: enable_bundle_adjustment=true + ba_max_iterations=100-200
# - Real-time applications: enable_bundle_adjustment=false (Priority on speed)
# - Balanced mode: enable_bundle_adjustment=true + ba_max_iterations=50-100
# - Low quality data: ba_min_inliers=8-12 (Increase minimum inlier requirement)
# - High quality data: ba_min_inliers=5-6 + ba_convergence_threshold=1e-8
#
# ========================================================================
# [Python Environment Setup Instructions]
# ========================================================================
#
# Method 1: Use system Python (leave conda_env empty)
# - Ensure installed: pip install magsac pysuperansac
#
# Method 2: Use conda environment
# - conda create -n barath_env python=3.9
# - conda activate barath_env  
# - pip install magsac pysuperansac
# - Set: conda_env=barath_env
#
# ======================================================================== 