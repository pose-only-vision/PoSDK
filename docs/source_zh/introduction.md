# PoSDK 用户指南

**GitHub 仓库**: [https://github.com/pose-only-vision/PoSDK](https://github.com/pose-only-vision/PoSDK)

PoSDK是一个面向 **空间视觉计算 (Spatial Visual Computing)** 的C++软件平台，可用于3D多视图几何处理，包括相机位姿估计、特征点云生成等。

本指南将介绍 PoSDK 架构、核心库的使用以及自定义插件的开发。



## 核心特性

- **纯位姿几何理论**：基于创新的纯位姿成像几何理论，实现高效、稳健的位姿估计
- **模块化插件系统**：通过 DataPtr、MethodPtr 灵活扩展功能
- **性能分析工具**：内置性能分析器，实时监控内存、CPU、时间等指标  
- **自动评估功能**：内置精度评估器，自动收集、统计和导出算法的多种精度指标
- **版权跟踪**：自动收集和展示算法的版权信息，保护知识产权
- **跨平台支持**：支持 macOS (x86_64/arm64)、Linux (x86_64/aarch64)
- **多语言日志**：中英文双语日志输出
- **平台集成与对比**：支持集成和对比主流三维重建平台（OpenMVG、COLMAP、GLOMAP等）→ [查看对比测试结果](benchmark_comparison/index.md)

## 系统架构

PoSDK 采用分层架构设计，核心计算引擎与上层应用隔离，并通过 SDK 提供灵活的二次开发接口。

```{figure} _static/structure.png
:alt: PoSDK Architecture Layers
:align: center
:width: 70%

PoSDK 架构分层示意图
```

主要包含以下组件：

- **核心层 (Core Layer)**: 
  - 包含基于 **纯位姿视觉几何理论** 的核心计算引擎（内部开发维护）。
  - 负责处理底层的几何计算、优化问题等。
- **接口层 (Interface Layer / SDK)**: 
  - 提供 **SDK 开发插件模块**，封装核心算法接口，支持用户进行二次开发。
  - 包含数据处理、特征提取与匹配、异常处理、稠密重建、跨平台支持等模块化功能。
  - **插件系统**: PoSDK 的核心特色之一，允许用户通过开发自定义插件（DataPtr, MethodPtr, BehaviorPtr）来动态加载和扩展算法功能，而无需修改核心库代码。
    - `DataPtr`: 用于封装各种数据类型。
    - `MethodPtr`: 用于实现具体的算法逻辑。
    - `BehaviorPtr`（预留）: 用于组织和调用一系列方法形成工作流。
- **应用层 (Application Layer)**:
  - 基于 SDK 和插件系统构建具体的业务应用，例如三维重建软件、SLAM 系统、AR 应用等。

## 版权跟踪与知识产权保护

PoSDK 内置了**版权自动跟踪功能**。

### 为什么需要版权跟踪？

3D视觉计算应用往往会使用多个算法库和工具，例如：
- 特征提取可能使用 OpenCV 的 SIFT/SURF
- 位姿估计可能使用 OpenGV 的求解器
- 优化求解可能使用 Ceres Solver
- 矩阵运算可能使用 Eigen

**问题**：第三方库通常有不同的许可证和版权要求，手动追踪和管理繁琐。

### PoSDK 的解决方案

PoSDK 的版权跟踪提供以下功能：

- **自动收集**：运行时自动收集所使用到的算法和库的版权信息
- **即时显示**：方法首次加载时展示版权声明
- **依赖追踪**：自动构建完整的算法调用依赖关系图
- **透明合规**：确保第三方库的版权信息得到妥善展示

```{figure} _static/copyright.png
:alt: Copyright Tracking System
:align: center
:width: 90%

版权跟踪工作原理：左侧展示了Method A依赖多个算法（算法a/b/c/d/e/f），每个算法都有自己的版权信息（copyright_1至copyright_5）。系统会自动追踪这些依赖关系，并在统一汇总展示Method A及其所有依赖算法的版权信息（见右侧），确保版权透明和合规性。
```

### 工作原理

如上图所示，版权跟踪的工作流程如下：

1. **依赖关系识别**：当Method A调用其他算法（如算法a、b、c等）时，系统自动识别各种依赖关系
2. **版权信息收集**：每个算法通过重载`Copyright()`函数声明版权信息
3. **自动去重合并**：系统自动收集并去重所有依赖算法的版权信息（如图中copyright_2被多个算法使用，但只显示一次）
4. **统一展示**：在Method A首次加载时，系统将自动展示其自身及所有依赖算法的完整版权信息列表


详细使用方法请参考：[版权跟踪功能文档](copyright_tracking.md)

## 自动评估功能

PoSDK 内置了**全局评估器 (EvaluatorManager)**，提供性能评估和数据分析功能。

### 为什么需要自动评估？

在科研和应用开发过程中，通常需要：
- 对比不同算法在相同数据集上的性能
- 评估同一算法在不同参数配置下的表现
- 统计分析评估结果（均值、中位数、标准差等）
- 生成可视化图表用于论文和报告

**问题**：手动收集数据、计算统计值、生成图表工作量大。

### PoSDK 的解决方案

PoSDK 的精度评估系统提供以下功能：

- **自动收集**：自动收集算法的评估结果（旋转误差、平移误差、重投影误差等）
- **智能分类**：按评估类型、算法名称、指标名称自动分类管理
- **统计分析**：自动计算均值、中位数、最大/最小值、标准差等统计量
- **CSV导出**：支持多种格式的CSV数据导出，便于后续分析
- **可视化生成**：自动生成高质量的对比图表（支持Python/matplotlib）
- **多类型备注**：支持为每个评估结果添加多种类型的备注信息（如核心运行时间、视图对标识等）


详细使用方法请参考：[评估系统文档](advanced_development/evaluator_manager.md)

## 平台集成与对比

PoSDK 支持与多个主流三维重建平台进行集成和对比测试，包括 OpenMVG、COLMAP、GLOMAP 等。

### 为什么需要平台对比？

当前主流的三维重建平台各有特色：
- **OpenMVG**: 经典的开源多视图几何库，提供完整的SfM流程
- **COLMAP**: 业界领先的三维重建系统，支持SfM和稠密重建
- **GLOMAP**: 新一代全局优化平台，专注于大规模场景快速重建

**问题**：如何客观评估不同平台在相同数据集上的性能和精度？

### PoSDK 的解决方案

PoSDK 提供了统一的对比测试框架：

- **统一数据格式**：支持将不同平台的输出转换为统一的数据格式进行对比
- **自动化测试**：通过配置文件和脚本实现自动化的批量测试
- **多维度评估**：
  - **性能对比**：运行时间、内存消耗等性能指标
  - **精度对比**：全局位姿误差（旋转/平移）、相对位姿误差等精度指标
  - **统计分析**：均值、中位数、最大/最小值、标准差等统计量


### 如何使用对比功能

1. **准备数据**：确保数据集包含真值（ground truth）信息
2. **配置测试**：在配置文件中指定要对比的平台和参数
3. **运行测试**：使用提供的脚本执行自动化测试
4. **查看结果**：系统自动生成对比报告和可视化图表

详细的对比测试结果和分析请参考：**[平台对比测试结果](benchmark_comparison/index.md)**

---

**下一步**：继续阅读 [安装指南](installation.md) 来开始使用 PoSDK。
